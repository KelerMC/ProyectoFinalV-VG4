pipeline {
    agent any
        tools {
        jdk 'JAVA'
        maven 'maven'
    }
    environment {
        SCANNER_HOME = tool 'sonar-scanner'
    }
        stages {
        stage("Git Checkout") {
            steps {
                git branch:'Developed', changelog:false, poll:false,url:'https://github.com/KelerMC/ProyectoFinalV-VG4'
            }
        }
        stage("Build with Maven") {
            steps {
                bat "mvn -f spring-petclinic-main clean compile -Dcheckstyle.skip=true"
            }
        }
        /*stage("Run Unit Tests") {
            steps {
                bat "mvn -f spring-petclinic-main test -Dcheckstyle.skip=true"
            }
        }*/
        stage("SonarQube Analysis ") {
            steps {
                bat "$SCANNER_HOME/bin/sonar-scanner -Dsonar.url=http://localhost:9000/ \
                    -Dsonar.login=squ_f98ffa7978805dd40117bf4113272c66f6164f59 \
                    -Dsonar.projectKey=ProyectoFinal \
                    -Dsonar.projectName=ProyectoFinal \
                    -Dsonar.sources=. \
                    -Dsonar.java.binaries=."
            }
        }
		stage("Deploy ") {
            steps {
				bat "mvn -f spring-petclinic-main wrapper:wrapper"
                bat "mvn -f spring-petclinic-main spring-boot:run -Dcheckstyle.skip=true"
            }
        }
        // And next stages if you want to define further...
    } // End of stages
} // End of pipeline